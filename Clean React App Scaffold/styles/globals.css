@custom-variant dark (&:is(.dark *));

/* Import all token files - order matters for deterministic application */
@import './tokens/core.css';
@import './tokens/light-theme.css';
@import './tokens/dark-theme.css';
@import './tokens/components.css';

/* IMPORTANT: Theme tokens are applied via themeManager.ts for deterministic behavior */
/* The CSS files above provide fallbacks but will be overridden by inline styles */

/* Global resets and base styles */
* {
  box-sizing: border-box;
}

html {
  font-size: var(--font-size);
  scroll-behavior: smooth;
}

body {
  margin: 0;
  padding: 0;
  font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
  font-weight: var(--font-weight-normal);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background: var(--color-bg);
  font-feature-settings: "rlig" 1, "calt" 1;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  /* Ensure body uses theme-managed colors for consistent appearance */
  transition: background-color 0.2s ease, color 0.2s ease;
}

/* Scroll lock class for modals/drawers */
.adsm-no-scroll {
  overflow: hidden !important;
  height: 100vh !important;
}

/* Boot overlay for app initialization */
.app-boot-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg, #0b1020);
  color: var(--color-text, #e2e8f0);
  font-size: 1.1rem;
  z-index: 9999;
}

/* Screen reader only content */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Focus styles for accessibility */
*:focus-visible {
  outline: 3px solid var(--color-ring);
  outline-offset: 2px;
}

/* High contrast focus for better accessibility */
@media (prefers-contrast: high) {
  *:focus-visible {
    outline-width: 4px;
    outline-color: currentColor;
  }
}

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Base element styles using tokens */
h1, h2, h3, h4, h5, h6 {
  margin: 0;
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  color: var(--color-text);
}

h1 { font-size: var(--font-size-3xl); }
h2 { font-size: var(--font-size-2xl); }
h3 { font-size: var(--font-size-xl); }
h4 { font-size: var(--font-size-lg); }
h5 { font-size: var(--font-size-base); }
h6 { font-size: var(--font-size-sm); }

p {
  margin: 0;
  line-height: var(--line-height-normal);
  color: var(--color-text);
}

a {
  color: var(--color-primary);
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* Button reset for atomic components */
button {
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
}

/* Input reset for atomic components */
input, textarea, select {
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
}

/* Utility classes using tokens */
.text-xs { font-size: var(--font-size-xs); }
.text-sm { font-size: var(--font-size-sm); }
.text-base { font-size: var(--font-size-base); }
.text-lg { font-size: var(--font-size-lg); }
.text-xl { font-size: var(--font-size-xl); }

.font-normal { font-weight: var(--font-weight-normal); }
.font-medium { font-weight: var(--font-weight-medium); }
.font-semibold { font-weight: var(--font-weight-semibold); }
.font-bold { font-weight: var(--font-weight-bold); }

.leading-tight { line-height: var(--line-height-tight); }
.leading-normal { line-height: var(--line-height-normal); }
.leading-relaxed { line-height: var(--line-height-relaxed); }

.rounded-sm { border-radius: var(--radius-sm); }
.rounded { border-radius: var(--radius-md); }
.rounded-lg { border-radius: var(--radius-lg); }
.rounded-xl { border-radius: var(--radius-xl); }
.rounded-full { border-radius: var(--radius-full); }

.p-xs { padding: var(--space-xs); }
.p-sm { padding: var(--space-sm); }
.p-md { padding: var(--space-md); }
.p-lg { padding: var(--space-lg); }
.p-xl { padding: var(--space-xl); }

.m-xs { margin: var(--space-xs); }
.m-sm { margin: var(--space-sm); }
.m-md { margin: var(--space-md); }
.m-lg { margin: var(--space-lg); }
.m-xl { margin: var(--space-xl); }

.gap-xs { gap: var(--space-xs); }
.gap-sm { gap: var(--space-sm); }
.gap-md { gap: var(--space-md); }
.gap-lg { gap: var(--space-lg); }
.gap-xl { gap: var(--space-xl); }

/* Application layout styles */
.app {
  min-height: 100vh;
  background: var(--color-bg);
  color: var(--color-text);
}

/* Layout utility classes */
.flex { display: flex; }
.h-screen { height: 100vh; }
.w-64 { width: 16rem; }
.flex-1 { flex: 1 1 0%; }
.overflow-auto { overflow: auto; }
.items-center { align-items: center; }
.justify-center { justify-content: center; }
.space-y-1 > * + * { margin-top: 0.25rem; }
.gap-3 { gap: 0.75rem; }
.mb-8 { margin-bottom: 2rem; }
.p-6 { padding: 1.5rem; }

/* Theme-aware background classes */
.bg-background { background-color: var(--color-bg); }
.bg-sidebar { background-color: var(--color-panel); }
.bg-sidebar-border { background-color: var(--color-border); }
.bg-primary { background-color: var(--color-primary); }
.bg-accent { background-color: var(--color-accent); }
.border-r { border-right-width: 1px; }
.border-sidebar-border { border-color: var(--color-border); }

/* Text color classes */
.text-primary-foreground { color: var(--color-background); }
.text-sidebar-foreground { color: var(--color-text); }
.text-accent-foreground { color: var(--color-text); }
.text-muted-foreground { color: var(--color-muted-foreground); }

/* Hover classes */
.hover\:bg-accent:hover { background-color: var(--color-accent); }
.hover\:text-accent-foreground:hover { color: var(--color-text); }

/* Transition classes */
.transition-colors { transition-property: color, background-color, border-color; transition-duration: 150ms; }

.content {
  padding: var(--space-md);
  max-width: 1200px;
  margin: 0 auto;
}

/* Component state classes for atomic system */
.adsm-info {
  background: var(--chip-info-bg);
  color: var(--chip-info-text);
  border: 1px solid var(--chip-info-border);
  padding: var(--space-sm);
  border-radius: var(--radius-md);
}

.adsm-success {
  background: var(--chip-success-bg);
  color: var(--chip-success-text);
  border: 1px solid var(--chip-success-border);
  padding: var(--space-sm);
  border-radius: var(--radius-md);
}

.adsm-warning {
  background: var(--chip-warning-bg);
  color: var(--chip-warning-text);
  border: 1px solid var(--chip-warning-border);
  padding: var(--space-sm);
  border-radius: var(--radius-md);
}

.adsm-error {
  background: var(--chip-danger-bg);
  color: var(--chip-danger-text);
  border: 1px solid var(--chip-danger-border);
  padding: var(--space-sm);
  border-radius: var(--radius-md);
}

.adsm-chip {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-xs) var(--space-sm);
  background: var(--chip-bg);
  color: var(--chip-text);
  border: 1px solid var(--chip-border);
  border-radius: var(--radius-md);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
}

/* Button classes for atomic system */
.adsm-btn,
.adsm-btn-primary,
.adsm-btn-secondary,
.adsm-button-primary,
.adsm-button-secondary {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-xs);
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius-md);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  line-height: 1.5;
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
  min-height: var(--touch-target-md);
  text-decoration: none;
  outline: none;
}

.adsm-btn,
.adsm-btn-primary,
.adsm-button-primary {
  background: var(--button-primary-bg);
  color: var(--button-primary-text);
}

.adsm-btn:hover:not(:disabled),
.adsm-btn-primary:hover:not(:disabled),
.adsm-button-primary:hover:not(:disabled) {
  background: var(--button-primary-hover);
}

.adsm-btn:active:not(:disabled),
.adsm-btn-primary:active:not(:disabled),
.adsm-button-primary:active:not(:disabled) {
  background: var(--button-primary-active);
  transform: translateY(1px);
}

.adsm-btn:disabled,
.adsm-btn-primary:disabled,
.adsm-button-primary:disabled {
  background: var(--button-primary-disabled);
  color: var(--button-primary-disabled-text);
  cursor: not-allowed;
  opacity: 0.6;
}

.adsm-btn-secondary,
.adsm-button-secondary {
  background: var(--button-secondary-bg);
  color: var(--button-secondary-text);
  border: 2px solid var(--button-secondary-border);
}

.adsm-btn-secondary:hover:not(:disabled),
.adsm-button-secondary:hover:not(:disabled) {
  background: var(--button-secondary-hover);
}

.adsm-btn-secondary:active:not(:disabled),
.adsm-button-secondary:active:not(:disabled) {
  background: var(--button-secondary-active);
  transform: translateY(1px);
}

.adsm-btn-secondary:disabled,
.adsm-button-secondary:disabled {
  background: var(--button-secondary-disabled);
  color: var(--button-secondary-disabled-text);
  border-color: var(--button-secondary-disabled);
  cursor: not-allowed;
  opacity: 0.6;
}

/* Input and select styles for atomic system */
.adsm-input,
.adsm-select {
  display: inline-flex;
  align-items: center;
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius-md);
  border: 2px solid var(--color-border);
  background: var(--input-background);
  color: var(--color-text);
  font-size: inherit;
  font-family: inherit;
  line-height: 1.5;
  transition: all 0.2s ease;
  min-height: var(--touch-target-md);
  outline: none;
}

.adsm-input:focus,
.adsm-select:focus {
  border-color: var(--color-ring);
  box-shadow: 0 0 0 1px var(--color-ring);
}

.adsm-input:disabled,
.adsm-select:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.adsm-select {
  cursor: pointer;
}

/* Enhanced input style for token editing */
.adsm-input-enhanced {
  display: inline-flex;
  align-items: center;
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius-md);
  border: 2px solid var(--input-border);
  background: var(--input-bg);
  color: var(--input-text);
  font-size: inherit;
  font-family: inherit;
  line-height: 1.5;
  transition: all 0.2s ease;
  min-height: var(--touch-target-md);
  outline: none;
  width: 100%;
}

.adsm-input-enhanced:focus {
  border-color: var(--color-focus-ring);
  box-shadow: 0 0 0 1px var(--color-focus-ring);
}

.adsm-input-enhanced:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Tab styles for diagnostics */
.adsm-tab {
  background: transparent;
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
}

.adsm-tab:focus-visible {
  outline: 3px solid var(--color-ring);
  outline-offset: 2px;
}

/* Enhanced focus styles for better visibility */
button:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
[role="button"]:focus-visible {
  outline: 3px solid var(--color-ring);
  outline-offset: 2px;
  box-shadow: 0 0 0 1px var(--color-background), 0 0 0 4px var(--color-ring);
}

/* High contrast mode improvements */
@media (prefers-contrast: high) {
  .adsm-btn,
  .adsm-btn-primary,
  .adsm-btn-secondary,
  .adsm-button-primary,
  .adsm-button-secondary {
    border: 2px solid currentColor;
  }
  
  .adsm-chip {
    border-width: 2px;
  }
}

/* Debug UI styles - scoped to prevent theme leakage */
.adsm-debug {
  /* Debug styles are isolated within this scope */
  /* DO NOT set :root or body colors here */
}

.adsm-debug .debug-panel {
  position: fixed;
  bottom: var(--space-sm);
  right: var(--space-sm);
  padding: var(--space-xs);
  font-size: var(--font-size-xs);
  line-height: var(--line-height-tight);
  max-width: 200px;
  z-index: 9999;
  pointer-events: none;
  user-select: none;
  border-radius: var(--radius-sm);
  backdrop-filter: blur(4px);
}

.adsm-debug .debug-panel-info {
  background: rgba(59, 130, 246, 0.1);
  color: var(--color-text);
  border: 1px solid rgba(59, 130, 246, 0.2);
}

.adsm-debug .debug-panel-warning {
  background: rgba(245, 158, 11, 0.1);
  color: var(--color-text);
  border: 1px solid rgba(245, 158, 11, 0.2);
}

.adsm-debug .debug-panel-error {
  background: rgba(239, 68, 68, 0.1);
  color: var(--color-text);
  border: 1px solid rgba(239, 68, 68, 0.2);
}

.adsm-debug .debug-banner {
  margin-bottom: var(--space-md);
  padding: var(--space-sm);
  font-size: var(--font-size-sm);
  border-radius: var(--radius-md);
  border: 1px solid currentColor;
}

.adsm-debug .debug-banner-warning {
  background: rgba(245, 158, 11, 0.1);
  color: var(--color-text);
  border-color: rgba(245, 158, 11, 0.3);
}

.adsm-debug .debug-banner-error {
  background: rgba(239, 68, 68, 0.1);
  color: var(--color-text);
  border-color: rgba(239, 68, 68, 0.3);
}

.adsm-debug .debug-content {
  background: var(--color-panel);
  color: var(--color-text);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: var(--space-lg);
  text-align: center;
}

.adsm-debug .debug-title {
  margin-bottom: var(--space-md);
  font-weight: var(--font-weight-semibold);
}

.adsm-debug .debug-description {
  margin-bottom: var(--space-md);
  line-height: var(--line-height-normal);
}

.adsm-debug .debug-details {
  margin-top: var(--space-md);
  font-size: var(--font-size-sm);
  line-height: var(--line-height-relaxed);
  text-align: left;
}

/* Debug mode indicator - only visible in development */
.adsm-debug .debug-mode-indicator {
  position: fixed;
  top: var(--space-sm);
  left: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  background: rgba(16, 185, 129, 0.1);
  color: var(--color-text);
  border: 1px solid rgba(16, 185, 129, 0.3);
  border-radius: var(--radius-full);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  z-index: 9998;
  pointer-events: none;
  user-select: none;
}

/* Contrast warning banner for development mode */
.adsm-debug .contrast-warning {
  position: fixed;
  top: 50px;
  left: var(--space-sm);
  right: var(--space-sm);
  padding: var(--space-sm);
  background: rgba(239, 68, 68, 0.1);
  color: var(--color-text);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: var(--radius-md);
  font-size: var(--font-size-sm);
  z-index: 9997;
  max-width: 500px;
  margin: 0 auto;
}

/* Token editor styling */
.tokens-grid {
  display: grid;
  gap: var(--space-3, 12px);
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
}

.token-cell {
  display: grid;
  gap: 6px;
  padding: 8px;
  border-radius: var(--radius-md, 10px);
  background: var(--color-panel);
  border: 1px solid var(--color-border);
}

.token-name { 
  color: var(--color-muted); 
  font-size: 12px; 
}

.token-cell input {
  background: var(--input-bg, var(--color-bg));
  color: var(--input-text, var(--color-text));
  border: 1px solid var(--input-border, var(--color-border));
  border-radius: 8px;
  padding: 8px 10px;
}

.token-field {
  display: grid;
  gap: var(--space-xs);
  padding: var(--space-md);
  border-radius: var(--radius-md);
  background: var(--color-panel);
  border: 1px solid var(--color-border);
}

/* Component card styling for drawer interaction */
.comp-card {
  background: var(--color-panel);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md, 10px);
  padding: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.comp-card:hover {
  background: var(--color-accent);
  border-color: var(--color-primary);
}

.comp-card:focus-visible { 
  outline: 2px solid var(--color-focus-ring, #60A5FA); 
  outline-offset: 2px; 
}

/* Override any hardcoded colors in debug contexts to prevent theme leakage */
.adsm-debug-container {
  /* Neutralize hardcoded Tailwind classes by using theme-aware tokens */
  /* This wrapper prevents debug UI from affecting the main app theme */
}

.adsm-debug-container .text-gray-600 {
  color: var(--color-muted-foreground) !important;
}

.adsm-debug-container .text-gray-500 {
  color: var(--color-muted-foreground) !important;
}

.adsm-debug-container .text-gray-800 {
  color: var(--color-text) !important;
}

.adsm-debug-container .text-gray-900 {
  color: var(--color-text) !important;
}

.adsm-debug-container .bg-white {
  background-color: var(--color-panel) !important;
}

.adsm-debug-container .bg-gray-50 {
  background-color: var(--color-accent) !important;
}

.adsm-debug-container .border-gray-200 {
  border-color: var(--color-border) !important;
}

.adsm-debug-container .border-gray-300 {
  border-color: var(--color-border) !important;
}

/* Scope specific color overrides for status indicators */
.adsm-debug-container .bg-blue-50 {
  background-color: rgba(59, 130, 246, 0.1) !important;
}

.adsm-debug-container .text-blue-600,
.adsm-debug-container .text-blue-700,
.adsm-debug-container .text-blue-800 {
  color: rgb(37, 99, 235) !important;
}

.adsm-debug-container .border-blue-200,
.adsm-debug-container .border-blue-500 {
  border-color: rgba(59, 130, 246, 0.3) !important;
}

.adsm-debug-container .bg-green-100,
.adsm-debug-container .bg-green-50 {
  background-color: rgba(34, 197, 94, 0.1) !important;
}

.adsm-debug-container .text-green-600,
.adsm-debug-container .text-green-800 {
  color: rgb(22, 163, 74) !important;
}

.adsm-debug-container .bg-red-100,
.adsm-debug-container .bg-red-50 {
  background-color: rgba(239, 68, 68, 0.1) !important;
}

.adsm-debug-container .text-red-600,
.adsm-debug-container .text-red-800 {
  color: rgb(220, 38, 38) !important;
}

.adsm-debug-container .bg-yellow-50,
.adsm-debug-container .bg-yellow-100 {
  background-color: rgba(245, 158, 11, 0.1) !important;
}

.adsm-debug-container .text-yellow-500,
.adsm-debug-container .text-yellow-800 {
  color: rgb(217, 119, 6) !important;
}

/* Ensure modal overlays and z-index elements don't interfere with debug mode */
.adsm-debug-container .adsm-modal-overlay {
  z-index: 1000;
}

/* Debug-scoped component variants */
.adsm-debug-container [role="dialog"],
.adsm-debug-container [role="alertdialog"] {
  /* Ensure dialogs use theme colors even in debug mode */
  color: var(--color-text);
  background: var(--color-panel);
}

/* Prevent debug tab styling from leaking to main app */
.adsm-debug-tabs {
  /* All tab content is scoped within this container */
}

.adsm-debug-tabs .adsm-tab {
  background: transparent !important;
  border: none !important;
  cursor: pointer !important;
  transition: all 0.2s ease !important;
  padding: 8px 16px !important;
  border-bottom: 2px solid transparent !important;
  color: var(--color-muted-foreground) !important;
}

.adsm-debug-tabs .adsm-tab[aria-selected="true"] {
  border-bottom-color: var(--color-primary) !important;
  color: var(--color-primary) !important;
  background: var(--color-accent) !important;
}

.adsm-debug-tabs .adsm-tab:hover {
  color: var(--color-text) !important;
  background: var(--color-accent) !important;
}